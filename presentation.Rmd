---
title: "Hello, R!"
author: "Yue Hu"
output:
  ioslides_presentation:
    self_contained: no
    logo: image/logo.gif
    transition: faster
    widescreen: yes
    slidy_presentation:
    incremental: yes
---
# Preface
## What are covered
* A overview of R
* Data manipulation (input/output, row/column selections, etc.)
* Descriptive and binary hypotheses (summary, correlation, t-test, etc.)
* Multiple regression (OLS, GLS, MLM, etc.)
* Presentation (table, graph)
* Version control (if we have time)




# An Overview of R
## What's R?
* R is a programming language

* R is developed and maintained by statisticians.

* R is a <span style="color:purple">weird</span> programming language
    + Weird for users of typical statistical software (such as STATA)
        + object-oriented programming (OOP).
    + Weird for programmers: inconsistent and strict coding
        + The debate of assignment operator (`=` vs. `<-`)
        + `library("interplot")` == `library(interplot)`
* So, why do we still learn that, given its weirdness?


## Why do you want to use R? {.columns-2 .build}
* It's free!! 
* It's developing!
    + R is very compatible with new techniques
    + e.g., Network analysis, spatial analysis with GIS, and text analysis with big data. 
* It's multi-lingual!
```{r eval = F}
"Hello 你好 안녕하세요 здравствуйте"
```
* It's popular!



<img src="http://revolution-computing.typepad.com/.a/6a010534b1db25970b01a3fc45e6fc970b-pi" height="400" width="450"/>
[Magoulas & King, 2014, *Data Science Salary Survey*.](http://www.oreilly.com/data/free/stratasurvey.csp)

## What can you do with R?

* Do statistics as STATA, SAS, SPSS, EXCEL,...
* Scrape data from websites as Python, Java,...
* Create presentation slides, documents, webpages as MS Word, Powerpoint, TexMaker, Dreamweaver,...
* Solve math problems as Matlab, Mathematica, ...
* An observation in the "useR" conference (2015):
    
    " I saw how R and Hadoop is used to make the <span style="color:purple">Tribal Wars game</span> engaging for 150M players; R is used to <span style="color:purple">teach high schoolers</span> to code, as their first programming language; R is used to help <span style="color:purple">veterinarians</span> identify lameness in horses using 3-d accelerometers ..."

## When you may not want to work with R: {.build}
When you do not understand exactly what you are doing...or you don't care,
```{r eval=FALSE}
# Calculate predicted probability in STATA
logit protest age edu church
prgen church, gen(p_church) rest(mean) ci level(95)
```


```{r eval=FALSE}
# Calculate predicted probability in R
m1 <- glm(protest ~ age + edu + church, data = ess, family = "binomial")
church <- with(ess, data.frame(age = weighted.mean(age, na.rm = T, w = dweight),
                               edu = weighted.mean(edu, na.rm = T, w = dweight), 
                               church = 0:1)) 
church_pp <- cbind(church, predict(m1, newdata = church.fake, type = "link", se = TRUE))
church_pp <- within(church_pp, {
    pp <- plogis(fit)*100
    lb <- plogis(fit - (1.96 * se.fit))*100
    ub <- plogis(fit + (1.96 * se.fit))*100
})
```


## When you don't have much time to learn it,

<div class="centered">
  <img src=image/LearningCurve2.png height="400"/>
  </div> Source: NYU Data Services.

## Software and package installations {.columns-2}
### Software installation
[![R](https://www.r-project.org/Rlogo.png)](https://www.r-project.org/)

[![Rstudio](https://www.rstudio.com/wp-content/uploads/2014/03/blue-250.png)](https://www.rstudio.com/products/rstudio/download/preview/)

<span style="color:green">Tip</span>s:
<div class="notes">
Install R before Rstudio; so does in updating.
Using the [Rstudio preview](https://www.rstudio.com/products/rstudio/download/preview/).
</div>


### Package installation and loading
Packages are "<span style="color:purple">Apps</span>" for your R system. You can use R without them, but if you want fun, install them ~

`install.packages(<package name>)`
`install_github("<repositary/package name>")`

[An example](https://github.com/sammo3182/interplot)

Click the apps: Load the package

`library(<package name>)`
`require(<package name>)`

## RStudio{.flexbox .vcenter}
<img src="image/rstudio.png" height="500" width = "900" />


## Wrap Up
* R is a programming language that can do a lot of statistical and non-statistical things.

* Install R, RStudio (optional), and packages (optional)

* Next: Let's Start the Journey
    + <div class="centered">![journey](http://i.imgur.com/PbLQzSi.gif)</div>

# Do Statistics with R
## Set where to locate the data and store the results
* Always check or set the <span style="color:purple">working directory</span> first
    + `getwd()`
    + `setwd("E:/R workshop/rworkshop")`
* Or click, click, click, and click in Rstudio
    + <img src=image/setwd.png />
 

## Vector {.smaller}
```{r}
1:10  # numeric (integer/double)
c("R", "workshop") # character
3 == 5  # logical
factor(1:3, levels = 1:3, labels = c("low", "medium", "high"))  # factor (<span style="color:green">Tip</span>)
```

<div class="notes">
The `factor` is a R *function*. Ususally, the first component ("`1:3`") of a R function is the  <span style="color:purple">object</span>, the target this function is going to work on. The rest components ("`levels = 1:3, labels = c("low", "medium", "high")`") are <span style="color:purple">arguments</span>, with which setting the special conditions the object is dealt.

If you are not sure about the utility of certain arguments, ask R for help by `?`, e.g.,
```{r eval=FALSE}
?factor
```

</div>


## Dataset {.smaller}
```{r}
matrix(1:4, ncol = 2)  # matrix
data.frame(x = 1:2, y = 3:4)  # data.frame
list(c("one", "two"), c(3, 4)) # 2-D list
```

----
```{r}
array(c(1:4,5:8), dim = c(2, 2, 3)) # 3-D or n-D "list""
```


## Save data to an object
```{r}
x <- rep(c(.01, .05, .1), times = 2) # repeat 1:5 for twice
df <- data.frame(x = 1:1, y = 3:4)
list <- list(x, df)

list # == print(list)
```

## Attributes of an object {.smaller .build}
* Structure
```{r}
str(df)
```
* Unique values (<span style="color:green">Tip</span>)
```{r}
unique(df$x)
```
<div class="notes">
What is the `$`?  It is used to call specific columns a data.frame. 

To call the components in a vector, we use "[]"
```{r}
x[3]
```

To call the components in a list, we use "[[]]"
```{r}
list[[2]]
```

</div>

* Names
```{r}
names(df)
```

----

Length
```{r}
length(x)
```

Class
```{r}
class(x);typeof(x)  # ; is used to write two commands in one line
```

## Detect the attributes
Using `is.`
```{r}
is.numeric(x)
is.na(x) # detect if x includes missing values
```


## Do math in R
```{r eval=FALSE}
# basic math
x + (1 - 2) * 3 / 4

# advanced math
x^2;sqrt(x);log(x);exp(x)

# matrix algebra
z <- matrix(1:4, ncol = 2)
z + z - z
z %*% z  # inner mul<span style="color:green">Tip</span>lication 
z %o% z  # outter mul<span style="color:green">Tip</span>lication

# logical evaluation
x == z; x != Z
x & z; x | z
x > z; x <= z
```

## Wrap up
* Set the working directory first: `setwd()`
* Four types of data: numeric, character, logical, factor
* Four types of datasets: matrix, data.frame, list, array
* Save the things into an object by `<-`, e.g., `list <- list(x, df)`
    + Objects have attributes (`str()`, `length()`, `names()`, etc.)
    + Detect the attributes with `is.`, e.g., `is.numeric(x)`
* Do math in R
* Next: let's have a look at the data, first.
    + <div class="centered">
    <img src=https://powerofus.force.com/servlet/rtaImage?eid=ka080000000D4YB&feoid=00N800000059i9I&refid=0EM800000000Tnw height = 150 width = 350/>
    </div>

# Data Analysis
## Input data {.build}
* R can read almost all types of datasets.
```{r eval=FALSE}
load("<FileName>.RData")

df_txt <- read.table("<FileName>.txt")
df_csv <- read.csv("<FileName>.csv")

```
* Some data are already embedded in R. To call them, use `data()`, e.g.
```{r eval=FALSE}
data(mtcars)
```


## Input data with packages{.smaller}
```{r eval=FALSE}
# Excel sheets
library(readxl)
df_excel <- read_excel("<FileName>.xls");read_excel("<FileName>.xlsx") 

# SPSS/STATA/SAS
library(foreign)
df_spss <- read.spss("<FileName>.sav")
df_stata <- read.dta("<FileName>.dta") 
df_sas <- read.sas7bdat("<FileName>.sas7bdat")  

# JavaScript Object Notation 
library(rjson)
df_json <- fromJSON(file = "<FileName>.json" )

# XML/Html
df_xml <- xmlTreeParse("<url>")
df_html <- readHTMLTable(url, which=3)

```
More instructions are available in this [blog](http://blog.datacamp.com/r-data-import-tutorial/).


## Output data {.build}
* Save in a R dataset (`.RData`) <span style="color:green">Tip</span>
```{r eval = F}
save(object, file = "./Data/mydata.Rdata")
```
<div class="notes">
In R, the directory are written with `/`.
</div>

* Save as `.csv`
```{r eval = F}
write.csv(object, file = "mydata.csv")
```


## Manipulate the data{.build}
* let's call a dataset first,
```{r}
data(mtcars)
```
* How many variables and what are they?
```{r}
ncol(mtcars);names(mtcars)
```

## Have a look at the data{.build}

```{r}
head(mtcars) # show the first six lines of mtcars

```

## Look at a specific area in a dataset

In a dataset or matrix, a special row and column can be specified by `data[col#,row#]` or `data["colName","rowName"]`. 

So, for example, to select the first two rows of the third and fourth columns:
```{r}
mtcars[1:2,3:4] # show first and the second rows of the third and fourth columns
```

## Row/column selection{.small .build}

* Select an entire row or column (<span style="color:green">Tip</span>:  The <span style="color:red">comma</span>!)
```{r eval=FALSE}
mtcars[,"mpg"] # show the column "mpg"
```

* Select components of a selected row or column
```{r}
mtcars[,"mpg"][3]  # show the third component of the column "mpg"
```

----

Select with special conditions
```{r}
mtcars[mtcars$mpg < 20,][1,] # show the first rows which mpg are below 5.
```

Create new rows/columns
```{r}
mtcars$id <- seq(1:nrow(mtcars))
names(mtcars)
```


## Descriptive analysis {.smaller}
For a dataset or a numeric vector
```{r}
summary(mtcars)
```
One can use `mean`, `sd`, `max`, `min`, etc. to extract specific descriptive statistics.

## Descriptive analysis (continue) {.smaller .build}
* For categorical vectors

```{r}
table(mtcars$cyl)
```

* For observation number and variable number
```{r}
nrow(mtcars)  # observation (N)
ncol(mtcars)  # variable number
```

## Data manipulation{.build}
* Create a variable into the dataset (<span style="color:green">Tip</span>)

```{r}
mtcars$newvar <- rbinom(32, 1, .5)  #create a random binomial variable 

mtcars$newvar <- c(1:nrow(mtcars)) # create an "ID" variable
```

<div class="notes">
Obviously, variables can be immediately overwrite without any specific setting. 

It is convenient but also <span style="color:purple">risky</span>.
</div>

* Remove a variable from the dataset

```{r}
mtcars$newvar <- NULL
```

* Remove variable, result, function, or data from the environment

```{r}
rm(x)
```

----

Recode a variable: e.g., numeric to binary, mpg > mean, 1, otherwise 0

```{r}
# Method I
mtcars$newvar[mtcars$mpg > mean(mtcars$mpg)] <- 1
mtcars$newvar[mtcars$mpg <= mean(mtcars$mpg)] <- 0

# Method II
mtcars$newvar <- ifelse(mtcars$mpg > mean(mtcars$mpg), 1, 0) # overwrite the NAs
mtcars$newvar <- ifelse(is.na(mtcars$mpg), NA,
                      ifelse(mtcars$mpg > mean(mtcars$mpg), 1, 0))

```

Label: Only nominal variables can have labels
```{r}
mtcars$newvar <- factor(mtcars$gear, levels = 3:5, labels = c("3-gear", "4-gear", "5-gear"))
table(mtcars$newvar)
```



## Wrap Up 
* Input/output: `load()`/`read.`series and `save()`/`write.`series
* A glimpse of data: `head()` or `data.frame[col#, row#]`
* Description: `summary()`, `table()`, `ncol()`, `nrow()`, 
    + More specific: `mean`, `sd`, `max`, `min`, etc.
* Manipulation: 
    + create: `mtcars$newvar <- c(1:nrow(mtcars))`
    + Remove: `mtcars$newvar <- NULL`; `rm()`
    + Recode: `recodevar[<condition>] <- <new value>`
    + label: using the `label` argument of `factor`.
* There are also [`apply` family](http://www.r-bloggers.com/r-tutorial-on-the-apply-family-of-functions/) functions for with batching management of data.

----

Next: the core task comes---hypothesis testing!

<div class="centered">
![core](http://i.imgur.com/VanhgtK.gif)
</div>

# Hypothesis Tests

## Binary Tests: Difference of mean

$H_{0}: \bar{cylinders} = \bar{gears},\ \alpha = .05$

```{r}
t.test(mtcars$cyl, mtcars$gears) 
```

----

`t.test` offers arguments `alternative`, `mu`, `paired`, and `conf.level` for users to change in two-tail/one-tail test, parameter mean, independent/paired comparison, and $\alpha$.

```{r eval=FALSE}
# one side, cyl > gear, alpha = .01
t.test(mtcars$cyl, mtcars$gear,
       alternative = "greater", conf.level = .99)     
       ) 

# comparing with the parameter (true value)
t.test(mtcars$cyl, mu = 6)   # the true mean is 6.

```



## Binary Tests: Correlation
$H_{0}: \rho_{(cyl,gear)} = 0,\ \alpha = .05$

```{r}
cor.test(mtcars$cyl, mtcars$gear)
```

----

`cor.test` offers various arguments overlapping with `t.test` for more specific settings. Moreover, users can use the `method` argument to set the method to calculate the correlations, "Pearson", "Kendall", or "Spearman." (<span style="color:green">Tip</span>)

```{r}
cor.test(mtcars$cyl, mtcars$gear, method = "kendall")
```

<div class="notes">
Do I have to type the `mtcars$` every time? 

* No you don't.
    + It offers a potential for cross-dataset operation, though.
    + Use `within()`: e.g., `within(mtcars, cor.test(cyl, gear))`
    + Use `attach()` (not recommonded)
</div>


----

We can get the correlation matrix, too:
```{r}
cor(mtcars[,1:4])
```

## Binary Tests: ANOVA{.smaller}
One way or two way ANOVA: (<span style="color:green">Tip</span>)

```{r}
aov_one <- aov(cyl ~ gear, data = mtcars) #one-way

aov_two <- aov(cyl ~ gear + am, data = mtcars) #two-way

summary(aov_one); summary(aov_two)
```

<div class="notes">
Sometimes, `summary` offers more organized results than `print`:

```{r}
aov_one #print it
summary(aov_one) #summarize it
```

</div>

## Wrap up
* T-test: `t.test(x, y = NULL, alternative = c("two.sided", "less", "greater"), mu = 0, paired = FALSE, conf.level = 0.95, ...)`

* Correlation: `cor.test(x, y, alternative = c("two.sided", "less", "greater"), method = c("pearson", "kendall", "spearman"), conf.level = 0.95, continuity = FALSE, ...) `

* ANOVA: `aov(formula, data = NULL, ...)`

----

Next: more commands are coming: multiple regressions~

+ <div class="centered">
![core](http://i.123g.us/c/bus_appreciate/card/101834.gif)
</div>

# Multiple Regression
## Ordinary Linear Regression{.build}
* we are detecting the contributions of the cylinders, horsepower, and weight of the care (Xs) to the mileage (Y): 
    
```{r}
lm_ols <- lm(mpg ~ cyl + hp + wt, data = mtcars)
``` 


## The result {.smaller}

```{r}
summary(lm_ols)
```  
  
## Nonlinear transition
ln, square, exponential, or inverse

```{r}
lm_tran <- lm(log(mpg) ~ I(cyl^2) + exp(hp) + I(1/wt), data = mtcars)
```

Of course, if you want, you can create special variables that equal `log(mpg)`, `cyl^2`, or `exp(hp)`, and use them to do the regression.


## The result {.smaller}

```{r}
summary(lm_tran)
```

## Break the factor variable

If we want to include a categorical variable into the regression, R will break it into binary variables for you.

```{r}
mtcars$gear_f <- factor(mtcars$gear, levels = 3:5, labels = c("3-gear", "4-gear", "5-gear"))

lm_f <- lm(mpg ~ cyl + hp + wt + gear_f, data = mtcars)

```

## The result {.smaller}

```{r}
summary(lm_f)
```

## Interaction
Two ways to write the model
```{r}
lm_in <- lm(mpg ~ cyl + hp * wt, data = mtcars)
lm_in2 <- lm(mpg ~ cyl + hp + wt + hp:wt, data = mtcars)
```

## The result {.smaller}
```{r}
summary(lm_in)
```

## Post-estimate diagnoses: Residural
  
```{r fig.height=3.5, fig.align="center"}
res_long <- mtcars$mpg - predict(lm_ols)
res_short <- resid(lm_ols)

plot(lm_ols, which = 1) # residural vs. fitted plot
```

## Post-estimate diagnoses: Outliers
```{r}
library(car) # Bonferonni p-value for most extreme obs

outlierTest(lm_ols)
```

----
```{r}
qqPlot(lm_ols)  #qq plot for studentized resid 
```


## Post-estimate diagnoses: Heteroscedasticity{.build}
* Heteroscedasticity 

```{r}
ncvTest(lm_ols) 
```

* Multicollinearity
```{r}
vif(lm_ols) 
```

----

Autocoorelation
```{r}
durbinWatsonTest(lm_ols)
```

## Logit
The process to run a logit is largely the same as running an OLS, except for the function name and certain arguments. 

```{r}
logit <- glm(vs ~ cyl + hp + wt, data = mtcars, family = "binomial")
```

## The result{.smaller}

```{r}
summary(logit)
```

## Interpretation: Margin
* Marginal effect

```{r message=FALSE}
library(mfx)
logit_m <- logitmfx(vs ~ cyl + hp + wt, data = mtcars) 
logit_m
```

## Interpretation: Predicted probability
Predicted Probability when `cyl` changes from 4 to 6.
```{r}
# Step 1: creat an aggregate data 
mtcars_fake <- with(mtcars, data.frame(cyl = 4:6, hp = mean(hp), wt = mean(wt)))
# Step 2: predict based on the new data
logit_pp4 <- cbind(mtcars_fake,predict(logit, newdata = mtcars_fake, type = "link", se = TRUE))
# Step 3: convert to probability 
logit_pp4 <- within(logit_pp4, {pp <- plogis(fit) 
                                lb <- plogis(fit - 1.96 * se.fit)
                                ub <- plogis(fit + 1.96 * se.fit)})
logit_pp4[,7:9]
```


## Wrap Up
* OLS: `lm(Y ~ X, data = data)`
    + Non-linear transformations: `I(X^2)`, `exp(X)`, `log(X)`.
    + Using factor variable: R will handle that for you.
    + Interaction: `lm(Y ~ X * Z, data = data)`.
    + Post-estimate diagnoses: `resid()`, `outlierTest()`, `qqPlot()`, `ncvTest()`, `vif()`, `durbinWatsonTest()`
* Logit: `glm(Y ~ X, data = data, family = "binomial")`
    + Margins: using `mfx::logitmfx`
    + Predict probabilty: 
        + Step 1: create an aggregate data
        + Step 2: predict the log odds
        + Step 3: transfer to probability
        
----

Next: How to effectively present the results?

<div class="centered">
![present](http://media.giphy.com/media/HQjYmJ2OGSNeE/giphy.gif)
</div>

# Presenting Techniques

## Tabling
There are over twenty packages for [table presentation](http://conjugateprior.org/2013/03/r-to-latex-packages-coverage/) in R. My favoriate three are `stargazer`, `xtable`, and `texreg`.

(Sorry, but all of them are for **Latex** output)

* `stargazer`: good for summary table and regular regression results
* `texreg`: when some results can't be presented by `stargazer`, try `texreg` (e.g., MLM results.)
* `xtable`: the most extensively compatible package, but need more settings to get a pretty output, most of which `stargazer` and `texreg` can automatically do for you.

## An example {.smaller}

```{r message = F}
library(stargazer)
stargazer(lm_ols, align = T)
```

----

Present in PDF

<div class="centered">
  <img src=image/table.png height="400"/>
  </div> 
  
* For the users of MS Word, click [here](http://www.r-statistics.com/2010/05/exporting-r-output-to-ms-word-with-r2wd-an-example-session/).

## Plotting

Three types of graphic presenting approaches in R:

* Basic plots: `plot()`.
* Lattice plots: e.g., `ggplot()`.
* Interactive plots: `shiny()`. (save for later)
    + <div class="centered">
  <img src="http://i.stack.imgur.com/qZObK.png" height="300"/>
  </div> 

## Basic plot
Pro:

* Embedded in R
* Good tool for <span style="color:purple">data exploration</span>. 
* <span style="color:purple">Spatial</span> analysis and <span style="color:purple">3-D</span> plots.

Con:

* Not very pretty
* Not very flexible


## An example: create a histogram

```{r fig.align="center"}
hist(mtcars$mpg)
```

## Adding some customizations

```{r fig.align="center", fig.height=3.5}
hist(mtcars$mpg, freq = F,  # plot the density rather than frequency
     breaks = 10,  # change the number of bins
     col = "purple", # change the color of the bins 
     xlab="Miles Per Gallon",   # adding the x-axis label
  	main="Histogram")  # adding a title
```

## Adding a normal curve{.smaller}

```{r fig.align="center", fig.height=3.5}
hist<-hist(mtcars$mpg, breaks=10, col="purple", xlab="Miles Per Gallon", 
  	main="Histogram with Normal Curve") 

xfit<-seq(min(mtcars$mpg),max(mtcars$mpg),length=40) 
yfit<-dnorm(xfit,mean=mean(mtcars$mpg),sd=sd(mtcars$mpg)) 
yfit <- yfit*diff(hist$mids[1:2])*length(mtcars$mpg) 
lines(xfit, yfit, col="blue", lwd=2)
```


## Saving the plot{.build}
* Compatible format:`.jpg`, `.png`, `.wmf`, `.pdf`, `.bmp`, and `postscript`.
* Process: 
      1. call the graphic device
      2. plot
      3. close the device

```{r eval = F}
jpeg("histgraph.jpg")
hist
dev.off()
```

<span style="color:purple">Tip</span>
<div class="notes">
Sometimes, RStudio may distort the graphic output.In this case, try to <span style="color:purple">zoom</span> or <span style="color:purple">export</span> it. 
</div>

----

The device list:

| Function                    	| Output to        	|
|-----------------------------	|------------------	|
| pdf("mygraph.pdf")          	| pdf file         	|
| win.metafile("mygraph.wmf") 	| windows metafile 	|
| png("mygraph.png")          	| png file         	|
| jpeg("mygraph.jpg")         	| jpeg file        	|
| bmp("mygraph.bmp")          	| bmp file         	|
| postscript("mygraph.ps")    	| postscript file  	|


## `ggplot`: the most popular graphic engine in R {.build}

+ Built by Hadley Wickham based on Leland Wilkinson's *Grammar of Graphics*.
+ It breaks the plot into components as <span style="color:purple">scales</span> and <span style="color:purple">layers</span>---increase the flexibility.
+ To use `ggplot`, one needs to install the package `ggplot2` first.

```{r message=FALSE}
library(ggplot2)
```
+ Then, let's redo the previous histogram in `ggplot`.


## histogram in `ggplot`
```{r fig.align="center", fig.height=2.7}
ggplot(mtcars, aes(x=mpg)) + 
    geom_histogram(aes(y=..density..), 
                   binwidth=2,
                   colour="black", fill="purple") +
    geom_density(alpha=.2, fill="blue")  + # Overlay with transparent density plot
    theme_bw() + 
    ggtitle("histogram with Normal Curve") + 
    xlab("Miles Per Gallon") + ylab("Density")
```


## histogram comparison in `ggplot`
```{r fig.align="center", fig.height=3}
ggplot(mtcars, aes(x=mpg, fill = factor(vs))) +  # Separate cars with V or straight engine
    geom_histogram(aes(y=..density..), 
                   binwidth=2, alpha = .5, position = "identity") +
    geom_density(alpha=.2)  + # Overlay with transparent density plot
    theme_bw() + 
    ggtitle("histogram with Normal Curve") + 
    xlab("Miles Per Gallon") + ylab("Density")
```

## Even fancier
Taking a third variable ("quarter mile time") into account: 

```{r echo=FALSE, fig.align="center"}
ggplot(mtcars,aes(mpg,qsec)) + 
  geom_point() + 
  geom_rug(col="purple",alpha=.5) +
  xlab("Miles Per Gallon") + ylab("1/4 Mile Time") + 
  theme_bw()
```


----

```{r echo=FALSE, fig.align="center"}
library(gridExtra)
#placeholder plot - prints nothing at all
empty <- ggplot()+geom_point(aes(1,1), colour="white") +
     theme(                              
       plot.background = element_blank(), 
       panel.grid.major = element_blank(), 
       panel.grid.minor = element_blank(), 
       panel.border = element_blank(), 
       panel.background = element_blank(),
       axis.title.x = element_blank(),
       axis.title.y = element_blank(),
       axis.text.x = element_blank(),
       axis.text.y = element_blank(),
       axis.ticks = element_blank()
     )

#scatterplot of x and y variables
scatter <- ggplot(mtcars,aes(mpg, qsec)) + 
  geom_point(aes(color=factor(vs))) + 
  xlab("Miles Per Gallon") + ylab("Density") + 
  scale_color_manual(values = c("orange", "purple")) + 
  theme(legend.position=c(1,1),legend.justification=c(1,1)) 

#marginal density of x - plot on top
plot_top <- ggplot(mtcars, aes(mpg, fill=factor(vs))) + 
  geom_density(alpha=.5) + 
  scale_fill_manual(values = c("orange", "purple")) + 
  theme(legend.position = "none")

#marginal density of y - plot on the right
plot_right <- ggplot(mtcars, aes(qsec, fill=factor(vs))) + 
  geom_density(alpha=.5) + 
  coord_flip() + 
  scale_fill_manual(values = c("orange", "purple")) + 
  theme(legend.position = "none") 

#arrange the plots together, with appropriate height and width for each row and column
grid.arrange(plot_top, empty, scatter, plot_right, ncol=2, nrow=2, widths=c(4, 1), heights=c(1, 4))
```

The codes to create these graphs are a little more complicated. For those who are interested in creating such a plot, click [here](http://rforpublichealth.blogspot.com/2014/02/ggplot2-cheatsheet-for-visualizing.html).


## Save `ggplot` {.build}

* `ggsave(<plot project>, "<name + type>")`:
* e.g., `ggsave("comp_hist.png")`
    + When the `<plot project>` is omitted, R will save the last presented plot. 
    + There are additional arguments which users can use to adjust the size, path, scale, etc.

```{r eval = F}
ggsave(filename = default_name(plot), plot = last_plot(),
  device = default_device(filename), path = NULL, scale = 1,
  width = par("din")[1], height = par("din")[2], units = c("in", "cm",
  "mm"), dpi = 300, limitsize = TRUE, ...)
```

## `qplot` function {.build}
The `ggplot` version of basic plot

* Redo the first histogram with `qplot`:

```{r eval=FALSE}
qplot(mtcars$mpg) 
```

* Equivalent to:

```{r eval=FALSE}
ggplot(mtcars, aes(x=mpg)) + geom_histogram() 
```

* Comparing to the basic plot engine: 
```{r eval=FALSE}
hist(mtcars$mpg)
```


## Two special types: estimate plot{.smaller}
Plot the comparable coefficients or other estimates (margins, predicted probabilities, etc.) with `dotwhisker`.

```{r message=FALSE}
library(dotwhisker)
library(broom)
lm_df <- tidy(lm_ols)
lm_df
```

----

```{r message=F, fig.align="center", fig.height=4}
lm_df <- by_2sd(lm_df, mtcars) %>% # rescale the coefficients
  filter(term != "(Intercept)") # omit intercept
dwplot(lm_df)
```

<span style="color:green">Tip</span>
<div class="notes">
`%>%` is a piper connector embedded in `dplyr` package (which is automatically called by `dotwhisker` in the example). One can use it to avoid too complicated embedding coding:
e.g., You want to see the maximum value of the mileage for carts with 6 cylinders. The regular code can be written as:
```{r eval= FALSE}
max(dplyr::select(filter(mtcars, cyl == 6), mpg))
```
With the piper connector, you can write as:

```{r eval = F}
mtcars %>% 
  filter(cyl == 6) %>% 
  dplyr::select(mpg) %>% 
  max
```



</div>


## Two special types: interaction plot{.smaller}
Plot the interactive effects with `interplot`.

```{r message=FALSE}
library(interplot)
summary(lm_in)

```

----

```{r fig.align="center"}
interplot(m = lm_in, var1 = "hp", var2 = "wt") + 
  xlab("Automobile Weight (thousands lbs)") + 
  ylab("Estimated Coefficient for \nGross horsepower")
```




## Wrap Up
* R has a bunch of packages for creating publishing-like tables, e.g., `stargazer`, `xtable`, and `texreg`

* There are three ways to visualize statistics in R: basic, lattice (`ggplot`), and interactive.
    + basic: e.g., `hist(<vector>)`
    + `ggplot`: /n  e.g., `ggplot(<data>, aes(x=<vector>)) + geom_histogram()`.

* Two special types of plot:
    + Estimate plot with [`dotwhisker`](https://cran.r-project.org/web/packages/interplot/vignettes/interplot-vignette.html).
    + Interaction plot with [`interplot`](https://cran.r-project.org/web/packages/dotwhisker/vignettes/dwplot-vignette.html).
    
## Almost the end: the last topic

<div class="centered">
![present](http://conservatives4palin.com/wp-content/uploads/2013/06/snob.gif)
</div>


# Version Control
## Just a brief introduction{.columns-2 .build}
* Tried to recall the deleted codes?
* Tried to figure out what changes?
* Saved a lot of replication files?
* Version control can help you: 



<div class = "center">
<img src=image/vcontrol2.png />
</div>

---- 

Tracking what you've changed:
<div class = "center">
<img src=image/vcontrol1.png />
</div>
 

## Using Git with RStudio

* RStudio has associate with the Git and SVN very well. 
* Process to use git:
    + Register a user account in https://github.com.
    + Connect your account with RStudio following [this instruction](http://www.molecularecologist.com/2013/11/using-github-with-r-and-rstudio/).
    + Create a version-control project in RStudio
        + <img src=image/vcontrol_set.png height = "200" />
    + Pull and Push


## External Sources
* Q&A Blogs: 
    + http://stackoverflow.com/questions/tagged/r
    + https://stat.ethz.ch/mailman/listinfo/r-help

* Graph Blogs:
    + http://www.cookbook-r.com/Graphs/
    + http://shiny.stat.ubc.ca/r-graph-catalog/

* Blog for new stuffs: http://www.r-bloggers.com/


----

<div class = "center">
<img src="http://www.junipercivic.com/images/Berry/thats-all-folks.jpg" height = "550" />
</div>

